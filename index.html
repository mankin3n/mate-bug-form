<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mate Academy ‚Äî Bug Report & Feature Request</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 1rem; }
    .container { max-width: 540px; width: 100%; }
    .card { background: #1e293b; border-radius: 16px; padding: 2rem; border: 1px solid #334155; }
    h1 { font-size: 1.5rem; margin-bottom: 0.25rem; color: #fff; }
    .subtitle { color: #94a3b8; font-size: 0.875rem; margin-bottom: 1.5rem; }
    .field { margin-bottom: 1rem; }
    label { display: block; font-size: 0.8125rem; font-weight: 500; color: #cbd5e1; margin-bottom: 0.375rem; }
    input, textarea, select { width: 100%; padding: 0.625rem 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: #e2e8f0; font-size: 0.875rem; font-family: inherit; }
    input:focus, textarea:focus, select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.15); }
    textarea { min-height: 120px; resize: vertical; }
    select { appearance: none; cursor: pointer; }
    .type-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem; }
    .type-btn { padding: 0.75rem; border: 2px solid #334155; border-radius: 10px; background: #0f172a; color: #94a3b8; cursor: pointer; text-align: center; transition: all 0.15s; font-size: 0.875rem; }
    .type-btn:hover { border-color: #475569; color: #e2e8f0; }
    .type-btn.active { border-color: #3b82f6; background: rgba(59,130,246,0.1); color: #60a5fa; }
    .type-btn .emoji { font-size: 1.25rem; display: block; margin-bottom: 0.25rem; }
    button[type="submit"] { width: 100%; padding: 0.75rem; background: #3b82f6; color: #fff; border: none; border-radius: 10px; font-size: 0.9375rem; font-weight: 600; cursor: pointer; transition: background 0.15s; }
    button[type="submit"]:hover { background: #2563eb; }
    button[type="submit"]:disabled { opacity: 0.6; cursor: not-allowed; }
    .success { text-align: center; padding: 2rem 0; }
    .success .check { font-size: 3rem; margin-bottom: 1rem; }
    .success h2 { color: #10b981; margin-bottom: 0.5rem; }
    .success p { color: #94a3b8; font-size: 0.875rem; }
    .success a { color: #3b82f6; text-decoration: none; }
    .error { color: #ef4444; font-size: 0.8125rem; margin-top: 0.5rem; }
    .badge { display: inline-block; background: #1e3a5f; color: #60a5fa; font-size: 0.6875rem; padding: 0.125rem 0.5rem; border-radius: 999px; margin-bottom: 1rem; }
    .priority-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; }
    .priority-btn { padding: 0.5rem; border: 1px solid #334155; border-radius: 8px; background: #0f172a; color: #94a3b8; cursor: pointer; text-align: center; font-size: 0.8125rem; transition: all 0.15s; }
    .priority-btn:hover { border-color: #475569; }
    .priority-btn.active { border-color: #3b82f6; color: #60a5fa; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="form-card">
      <span class="badge">Mate Academy Oy</span>
      <h1>Report a Bug or Request a Feature</h1>
      <p class="subtitle">Help us improve Mate Football and UpCharge products</p>

      <form id="bug-form" onsubmit="return submitForm(event)">
        <div class="type-row">
          <div class="type-btn active" onclick="setType('bug')" id="type-bug">
            <span class="emoji">üêõ</span>Bug Report
          </div>
          <div class="type-btn" onclick="setType('feature')" id="type-feature">
            <span class="emoji">üí°</span>Feature Request
          </div>
        </div>
        <input type="hidden" id="type" value="bug">

        <div class="field">
          <label for="product">Product</label>
          <select id="product" required>
            <option value="">Select product...</option>
            <option value="Mate Football">Mate Football (matefootball.fi)</option>
            <option value="UpCharge POS">UpCharge POS Station</option>
            <option value="UpCharge Business">UpCharge Business Platform</option>
            <option value="UpCharge IoT">UpCharge IoT Hub</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div class="field">
          <label for="title">Title *</label>
          <input type="text" id="title" placeholder="Brief description of the issue or request" required>
        </div>

        <div class="field">
          <label for="description">Description *</label>
          <textarea id="description" placeholder="What happened? What did you expect? Steps to reproduce (for bugs)..." required></textarea>
        </div>

        <div class="field">
          <label>Priority</label>
          <div class="priority-row">
            <div class="priority-btn" onclick="setPriority('low')" id="pri-low">Low</div>
            <div class="priority-btn active" onclick="setPriority('medium')" id="pri-medium">Medium</div>
            <div class="priority-btn" onclick="setPriority('high')" id="pri-high">High</div>
          </div>
          <input type="hidden" id="priority" value="medium">
        </div>

        <div class="field">
          <label for="email">Your email (optional)</label>
          <input type="email" id="email" placeholder="For follow-up questions">
        </div>

        <button type="submit" id="submit-btn">Submit Report</button>
        <div class="error" id="error-msg" style="display:none"></div>
      </form>
    </div>

    <div class="card" id="success-card" style="display:none">
      <div class="success">
        <div class="check">‚úÖ</div>
        <h2>Thank you!</h2>
        <p>Your report has been submitted and added to our development board.</p>
        <p style="margin-top: 1rem;"><a href="#" onclick="resetForm(); return false;">Submit another</a></p>
      </div>
    </div>
  </div>

  <script>
    let selectedType = 'bug';
    let selectedPriority = 'medium';

    function setType(type) {
      selectedType = type;
      document.getElementById('type').value = type;
      document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('type-' + type).classList.add('active');
    }

    function setPriority(pri) {
      selectedPriority = pri;
      document.getElementById('priority').value = pri;
      document.querySelectorAll('.priority-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('pri-' + pri).classList.add('active');
    }

    async function submitForm(e) {
      e.preventDefault();
      const btn = document.getElementById('submit-btn');
      const errEl = document.getElementById('error-msg');
      errEl.style.display = 'none';
      btn.disabled = true;
      btn.textContent = 'Submitting...';

      const title = document.getElementById('title').value.trim();
      const description = document.getElementById('description').value.trim();
      const product = document.getElementById('product').value;
      const email = document.getElementById('email').value.trim();
      const prefix = selectedType === 'bug' ? '[BUG]' : '[FEATURE]';
      const priTag = selectedPriority === 'high' ? ' üî¥' : selectedPriority === 'low' ? ' üü¢' : ' üü°';

      const taskTitle = `${prefix} ${title}${priTag}`;
      const taskBody = `**Product:** ${product}\n**Type:** ${selectedType}\n**Priority:** ${selectedPriority}\n${email ? '**Reporter:** ' + email + '\n' : ''}\n---\n\n${description}`;

      try {
        const resp = await fetch('http://209.38.223.61:3000/rest/tasks', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0Zjg4YzhkZS1hYmZhLTQ0ZjQtOWZiZi1jZjIwOWIxYzNhZGMiLCJ0eXBlIjoiQVBJX0tFWSIsIndvcmtzcGFjZUlkIjoiNGY4OGM4ZGUtYWJmYS00NGY0LTlmYmYtY2YyMDliMWMzYWRjIiwiaWF0IjoxNzcyMDIxMDQ4LCJleHAiOjQ5MjU2MjEwNDQsImp0aSI6IjBiYzE2NWJhLWI1YzAtNDVlNi1iZGJmLTg4MTVlYzVjYWY3MiJ9.O3wtZMYA5fPjNkEFwC9VzV5U8G3XZQxZnsoCuj1WdyY'
          },
          body: JSON.stringify({
            title: taskTitle,
            status: 'TODO',
            bodyV2: { markdown: taskBody }
          })
        });

        if (!resp.ok) throw new Error('Server error');
        
        document.getElementById('form-card').style.display = 'none';
        document.getElementById('success-card').style.display = 'block';
      } catch (err) {
        errEl.textContent = 'Failed to submit. Please try again or email info@matefootball.fi';
        errEl.style.display = 'block';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Submit Report';
      }
      return false;
    }

    function resetForm() {
      document.getElementById('bug-form').reset();
      setType('bug');
      setPriority('medium');
      document.getElementById('form-card').style.display = 'block';
      document.getElementById('success-card').style.display = 'none';
    }
  </script>
</body>
</html>
